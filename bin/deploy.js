// Generated by CoffeeScript 1.3.3
(function() {
  var file, fs, oldRead, options, output, parser, path, readFunc, stream, utilities, _i, _len, _ref;

  fs = require('fs');

  utilities = require('../lib/utilities') || require('../src/utilities');

  path = require('path');

  parser = require('../lib/parser') || require('../src/parser.js');

  options = parser.options;

  readFunc = function(filename) {
    utilities.addFileToList(path.resolve(filename));
    return utilities.replaceRequires("" + (fs.readFileSync(filename, 'utf-8')) + "\n", options.preprocessor);
  };

  if (options.lint) {
    oldRead = readFunc;
    readFunc = function(filename) {
      utilities.hint(filename);
      return oldRead(filename);
    };
  }

  output = "//" + (JSON.stringify(options)) + "\n";

  _ref = options.files;
  for (_i = 0, _len = _ref.length; _i < _len; _i++) {
    file = _ref[_i];
    output += readFunc(file);
  }

  if (options.output) {
    stream = fs.createWriteStream(options.output, {
      flags: 'w'
    });
  } else {
    stream = process.stdout;
  }

  options.writeFunction(output, stream);

}).call(this);
